{% load static %}

<!-- Modal: Thêm Sản Phẩm Mới (self-contained fragment) -->
<div id="productModal" class="fixed inset-0 bg-black/30 hidden items-center justify-center z-50">
    <!-- Make modal fit the web width (with sensible max width) and enable scrolling when content is too tall -->
    <div class="w-full max-w-[1100px] mx-4 rounded-2xl bg-white shadow-md overflow-hidden" role="dialog" aria-modal="true"
         aria-labelledby="productModalTitle">
        <!-- Scrollable content wrapper so the modal body scrolls when taller than the viewport -->
        <div class="product-modal-scroll">
            <div class="px-4 py-3 flex items-center justify-between sticky-header border-b border-slate-200 rounded-t-2xl">
                <!-- prettier title with icon -->
                <div class="flex items-center gap-3">
                    <h3 id="productModalTitle" class="font-semibold text-lg">Thêm Sản Phẩm Mới</h3>
                </div>
                <!-- prettier close button with icon and accessible label -->
                <button id="closeModalBtn" class="flex items-center gap-2 text-slate-600 hover:bg-slate-100 px-3 py-1 rounded-md" type="button" aria-label="Đóng" title="Đóng">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <form id="productModalForm" class="p-4" method="post" action="#" enctype="multipart/form-data">
                {% csrf_token %}

                <input type="hidden" id="productId" name="productId"/>
                <div class="rounded-2xl border border-slate-200 bg-[#f5f8ff] p-6 mb-6">
                    <h2 class="text-xl font-bold mb-4">Thông Tin Cơ Bản</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium mb-1" for="fName">Tên Sản Phẩm *</label>
                            <input id="fName" name="name" type="text" required placeholder="Nhập tên sản phẩm"
                                   class="w-full rounded-lg border border-slate-300 px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-gem-mid"/>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1" for="fSku">Mã SKU *</label>
                            <input id="fSku" name="sku" type="text" required placeholder="Nhập mã SKU"
                                   class="w-full rounded-lg border border-slate-300 px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-gem-mid"/>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1" for="fCategory">Danh Mục *</label>
                            <select id="fCategory" name="category" required
                                    class="w-full rounded-lg border border-slate-300 px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-gem-mid">
                                <option value="">Chọn danh mục</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1" for="fPrice">Giá</label>
                            <input id="fPrice" name="price" type="number" step="0.01" min="0" value="0.00"
                                   class="w-full rounded-lg border border-slate-300 px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-gem-mid"/>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium mb-1" for="fDesc">Mô Tả</label>
                            <textarea id="fDesc" name="description" rows="3" placeholder="Nhập mô tả sản phẩm"
                                      class="w-full rounded-lg border border-slate-300 px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-gem-mid"></textarea>
                        </div>
                    </div>
                </div>
                <div class="rounded-2xl border border-slate-200 bg-[#e7edfb] p-6 mb-6">
                    <h2 class="text-xl font-bold mb-4">Hình Ảnh Sản Phẩm</h2>

                    <!-- Dropzone area -->
                    <div id="dropZone"
                         class="bg-[#dbe7fd] rounded-xl p-6 flex flex-col items-center justify-center mb-4 border-2 border-dashed border-transparent hover:border-slate-300 transition">
                        <div class="flex flex-col items-center text-center max-w-md">
                            <svg class="w-10 h-10 text-[#2415cc] mb-2" fill="none" stroke="currentColor" stroke-width="2"
                                 viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                      d="M4 16v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"></path>
                                <polyline points="16 10 12 14 8 10"></polyline>
                                <line x1="12" y1="4" x2="12" y2="14"></line>
                            </svg>
                            <div class="text-base text-slate-700 mb-1">Kéo thả hình ảnh vào đây, hoặc nhấp để chọn</div>
                            <div class="text-sm text-slate-500 mb-4">Tải lên nhiều góc độ để tăng độ chính xác nhận diện
                            </div>
                            <button type="button" id="chooseFilesBtn"
                                    class="px-4 py-2 rounded-lg bg-white border border-slate-300 font-semibold text-slate-700 shadow">
                                + Chọn Tệp
                            </button>
                        </div>
                        <input id="fFiles" type="file" accept="image/*" multiple class="hidden"/>
                    </div>

                    <!-- Previews -->
                    <div id="filePreviewContainer" class="flex flex-wrap gap-4"></div>

                    <!-- Form error -->
                    <div id="formError" class="mt-3 text-sm text-orange-600 hidden"></div>

                </div>

                <div class="flex justify-end gap-4 mt-6">
                    <button type="button" id="cancelAddProductBtn"
                            class="px-6 py-2 rounded-lg bg-orange-600 text-white font-semibold">Hủy
                    </button>
                    <button type="button" id="saveProductBtn"
                            class="px-6 py-2 rounded-lg bg-[#2415cc] text-white font-semibold flex items-center gap-2">
                        Lưu Sản Phẩm
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- small styles: hide scrollbar but allow scrolling; helper for sticky header inside modal -->
<style>
.product-modal-scroll {
  max-height: calc(100vh - 4rem);
  overflow-y: auto;
  -ms-overflow-style: none; /* IE and Edge */
  scrollbar-width: none; /* Firefox */
}
.product-modal-scroll::-webkit-scrollbar { display: none; } /* Chrome, Safari */

/* sticky header inside the scroll container */
.sticky-header {
  position: sticky;
  top: 0;
  z-index: 20;
  background: white; /* prevent content bleed-through when scrolling */
}
</style>
